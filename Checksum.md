## Checksum

### 1. Checksum이 뭔가요?

Checksum은 한글로 검사합이라는 뜻으로 옛날에는 네트워크 통신에만 쓰이는 용어였지만
현재는 전산과 같은 일상생활에도 많이 사용되는 비법이다.
하지만 요즘에는 계산하는 방법이 너무 공개되어 있어서 별 효과는 없다.

### 2. Checksum을 사용하는 이유

네트워크 통신에서의  Checksum은 원본 패킷의 데이터와 도착했을 때의
패킷의 데이터를 비교했을 때 데이터의 손실이 있었는지 확인하는 방법이다.

그래서 네트워크 통신을 하면서 패킷이 정상적으로 도착한 건지 확인하기 위해서 사용한다.

### 3. Checksum 계산하기

Checksum을 계산하는 방법은 다음과 같다.

1. 패킷의 모든 데이터를 2 byte, 즉 16진수 4자리로 끊어서 모은다.
2. 모든 16진수 4자리 숫자를 모두 더한다. (이때, Checksum은 0x0000으로 비워둔다.)
3. 모두 더한 값이 만약 4 byte를 넘었다면 4 byte씩 끊어서 모두 더한다.
4. 그렇게 나온 결과물을 NOT 연산하여 계산하고 그 값을 checksum 값이라고 한다.
5. 그럼 패킷의 모든 데이터와 checksum 값을 합쳐서 1~4번의 연산을 진행한다.
6. 그 값이 0이라면 데이터에 오류가 없는 것이다.

이렇게 말로만 들으면 정확하게 무슨 소리인지 잘 모를 것이다.
그래서 임의의 패킷 데이터를 가지고 우리가 직접 계산을 해보도록 하겠다.

IPv4의 패킷 데이터는 Checksum 값을 제외하고 36 byte의 값이 존재한다고 하자.
그러면 그 36 byte의 데이터를 4 byte 씩 끊어서 두면 다음과 같다.

```Bytes
0x1234  0x2345  0x3456  0x4567  0x5678
0x6789  0x789A  0x89AB  0x9ABC
```

그럼 이 값을 모두 더해보면 다음과 같다.

```Sum
0x30A38
```

4 byte가 넘었으므로 넘은 3을 1의 자리에 더한다.

```sum
0x0A38 + 0x0003 = 0x0A3B
```

이를 NOT 연산하면 다음과 같다.

```NOT
0x0A3B => 0000 1010 0011 1011 (2) => 1111 0101 1100 0100 (2)
=> 0xF5C4
```

그럼 0xF5C4가 Checksum 값이 된다.
Checksum 값을 포함하여 위의 36 byte와 더하면 다음과 같다.

```sum
0x30A38 + 0xF5C4 = 0x3FFFC (4 byte가 넘으므로)
=> 0xFFFC + 0x0003 = 0xFFFF
```

이를 NOT 연산하면 0000이 되어 0x0이 된다.
0이 되었으므로 패킷에 데이터 손상이 없었음을 알 수 있다.

이렇게 완벽해보이는 Checksum 방식이지만 요즘엔 이 방법을 너무나도 쉽게 알 수 있고
오류가 두 개 이상나고 그 값이 우연히 0을 만드는 수가 된다면 오류를 검증하지 못할 수도 있다.