## 다른 네트워크 대역에 있는 네트워크 장비와 통신하기

지금까지는 이더넷 프로토콜을 이용해서 같은 네트워크 대역에 존재하는
네트워크 장비끼리의 통신을 했었다.

이번에는 IPv4, ICMP, Ethernet 프로토콜을 이용하여
다른 네트워크 대역에 있는 네트워크 장비와 통신을 하는 과정에 대해서 알아보도록 하겠다.

다른 네트워크 대역을 찾아가기 위해서는 MAC 주소를 가지는 하나의 네트워크 장비가 가지고 있는
라우팅 테이블에 대해서 알고 있어야 한다.

### 1. 라우팅 테이블

라우팅 테이블은 본 네트워크 장비가 어떠한 네트워크 대역에 존재하는 네트워크 장비와 통신하기 위해서
도착해야하는 네트워크 대역에 따른 찾아가야하는 IP 주소를 매칭시켜놓은 테이블이다.

이렇게 말하면 정확하게 이해가 되지 않을 수도 있다.
자신의 컴퓨터의 라우팅 테이블을 확인하기 위해서는
다음과 같은 명령을 cmd에 작성하면 된다.

```cmd
netstat -r
```

여기서 r은 Routing Table(라우팅 테이블)의 약자이다.
이 명령을 내리면 자신의 컴퓨터의 라우팅 테이블을 보여주게 된다.

네트워크 장비와 통신하는 과정에서 이는 다시 다루게 될 것이니 간단하게만 알고 있으면 될 것 같다.

### 2. 다른 네트워크 대역에 있는 네트워크 장비와 통신하는 과정

다음은 다른 네트워크 대역에 있는 네트워크 장비와 통신하는 과정을 그림으로 표현한 것이다.
![adfasd](./img/RoutingImage.jpg)

우리는 PC A를 사용하고 있고 다른 네트워크 대역에 있는 PC J와 통신하고자 한다.
공유기 CD는 공유기 CD와 라우터 사이에 있는 네트워크 대역과 PC A가 속하는 네트워크 대역 둘 다 속하므로
각각의 네트워크 대역에서 사용할 수 있는 IP 주소를 각각 부여하였다.
공유기 GH도 마찬가지다.

일단 현재 상황에서 하는 통신은 라우팅 테이블에 PC J가 속한 네트워크 대역과 통신하고자 할 때
공유기 CD로 향하라는 라우팅 테이블이 설정되어 있다는 가정하에 실행한다.
라우팅 테이블이 설정되어 있지 않으면 어디로 통신을 해야하는지 모르기 때문에 설정되어 있어야 한다.
보통 이 설정은 네트워크 기사분께서 해주신다.

PC A는 Ethernet + IPv4 + ICMP으로 패킷을 만들게 되는데
여기서 Ethernet을 확인해보면 다음과 같다.

```Ethernet
cc cc cc cc
cc cc aa aa
aa aa aa aa
08 00
```

Ethernet 프로토콜은 도착지의 MAC 주소가 먼저 작성되므로
cc:cc:cc:cc:cc:cc가 먼저 저장되고 출발지 MAC 주소인 aa:aa:aa:aa:aa:aa가 뒤에 저장된다.
그런데 Ethernet 프로토콜의 도착지가 우리가 통신하고자하는 PC인 PC J의 IP 주소가 아니라
같은 네트워크 대역안에 있는 공유기의 IP 주소임을 알 수 있다.
이는 패킷 통신을 하면서 Ethernet 프로토콜의 내용을 새로 작성하면서 전진해나가기 때문이다.
그래서 Ethernet 패킷을 작성할 때는 내가 갈 수 있는 최대한의 정보 위치를 작성한다.
라우팅 테이블을 확인해보면 PC A가 PC J의 네트워크 대역에 가기 위해서는
공유기 CD의 IP 주소로 가라고 되어 있기 때문에 Ethernet 프로토콜의 구조가 저렇게 작성된다.

일단 이렇게 패킷을 작성한 뒤,
패킷을 같은 네트워크 대역에 있는 스위치에게 보내게 되는데
스위치는 2계층 네트워크 장비이므로 Ethernet까지만 확인해보고
자신에게 온 것이 아니므로 공유기 CD에게 보낸다.
그러면 공유기 CD는 자신에게 온 것이 맞다는 것을 인지하고
IPv4를 확인해보고 최종 목적지인 PC J의 네트워크 대역을 확인하고
Ethernet 프로토콜을 자신의 라우팅 테이블을 확인하고 다시 작성한다.
그렇게 공유기 CD에서 라우터를 지나서 공유기 GH로 갔다가 스위치로 갔다가 PC J에 도착하게 되는 것이다.
하나하나 지나갈 때 마다 Ethernet 프로토콜은 다시 작성 된다.
그리고 다시 응답을 할 때는 ICMP의 값을 변경하고 Ethernet 프로토콜을 올 때와 반대로 작성하여
돌아가는 것이 최종적인 통신의 마무리이다.

