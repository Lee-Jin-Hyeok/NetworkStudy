## 스위치[Switch] vs 허브[Hub]

### 1. 스위치와 허브가 무엇인가요?

스위치와 허브는 각각 OSI 기준 2계층, 1계층 장비로서, 스위치와 허브에 달린 포트에 전기적 신호가 오면
그 신호를 바탕으로 다른 포트로 전기적 신호를 전달하는 역할을 하는 장비이다.

#### 1-1. 허브(Hub)

허브는 전기적 신호로 들어오는 모든 신호에 대해서 들어온 포트를 제외한 다른 모든 포트로 신호를 보내는
역할을 하는 중간자이다.

허브 내구 부조는 버퍼와 CPU가 존재하지 않아, 아주 단순한 구조로 이루어져 있고
기억하는 버퍼나 CPU가 없기 때문에 MAC 주소를 저장할 수 없어,
MAC 주소를 학습하는 것이 아니라 모든 포트로 신호를 보내는 방식을 사용한다.

따라서 허브를 중심으로 PC가 4개(A, B, C, D)가 존재하고,
PC A에서 ping 명령어를 통해 PC D에게 통신을 하고자 한다.
그럴 때 허브는 다음과 같이 동작한다.

1.  PC A에서 ping 명령어를 실행하면 ping 명령어는 내부적으로 Ethernet + ICMP 패킷을 보내므로
    ICMP 패킷을 보낸다.
2.  하지만 ICMP에는 도착지 MAC 주소가 필요하므로 ARP 패킷을 먼저 브로드캐스트로 보낸다.
3.  PC A에서 ARP가 브로드캐스트로 가면 갈 수 있는 곳은 허브밖에 없으므로 허브로 갔다가
    허브는 모든 전기적 신호를 모든 포트로 보내므로 PC B, C, D에게 보내고
    패킷이 자신의 것이 아니라는 것을 알게 된 PC B와 PC C는 패킷을 버리고
    PC D는 패킷을 받는다.
4.  PC D가 받은 ARP 패킷을 응답 패킷으로 가서 다시 PC A로 보낸다.
5.  MAC 주소를 알아냈으니 ICMP 패킷을 다시 작성하여 PC D로 보낸다.
6.  허브가 ICMP 패킷을 받았지만 허브는 이미 왔다간 MAC 주소를 저장하지 않기 때문에
    또 ICMP 패킷을 브로드캐스트로 보낸다.(패킷이 온 포트는 제외)
7.  PC B, C는 자신의 것이 아니라는 것을 알고 패킷을 버리고,
    PC D는 ICMP 패킷을 받고 ICMP 패킷을 응답패킷으로 바꾸어서 다시 PC A에게 보낸다.

이렇게 허브를 통하여 ping 통신을 할 수 있다.

허브는 모든 전기적 신호를 브로드캐스트로 보내므로 효율이 좋지 못하다.
그리고 허브는 콜리전 도메인이 1개인데,
여기서 콜리전 도메인이란, 패킷이 전송될 때 충돌이 일어나는 영역을 말한다.
만약 PC A와 PC D가 동시에 허브에게 패킷을 보내면 허브는 어떻게 처리할까?
물론 전기적 신호가 들어왔으므로 브로드캐스트로 보내기는 하겠지만
분명히 패킷에 손실이 있을 것이다.
그래서 그 패킷을 받은 PC는 패킷이 손실되었다는 것을 알고 패킷을 버리고 다시 달라고 요청한다.
이 요청은 총 15번 반복되며 더 이상 반복될 시 중지한다.
그래서 허브는 콜리전도메인이 1개이므로 허브와 연결되어 있는 모든 네트워크 장비는 충돌날 수 있다.

#### 1-2. 스위치(Switch)

스위치도 허브와 마찬가지로 네트워크 장비 중간에서 연결을 하는 중간자 역할을 하는
OSI 기준 2계층 네트워크 장비이다.

스위치는 허브와는 다르게 브로드캐스트로 모든 신호를 보내지 않고
내부적으로 CPU와 버퍼를 가지고 있기 때문에 MAC 주소를 학습하는 능력을 가지고 있다.
그럼 스위치를 사용하는 PC 4대가 있을 때 ping 명령어가 어떻게 동작하는지 알아보도록하자.

1.  PC A가 ping 명령어를 통해 PC D에게 ICMP 패킷을 만든다.
    ICMP 패킷을 만드는 데에는 목적지 MAC 주소가 필요하므로 ARP 패킷을 먼저 보낸다.
2.  ARP 패킷은 스위치에 도착하는데 스위치에는 MAC 주소에 대한 아무 정보가 없으므로
    처음에는 허브와 마찬가지로 동작한다.
3.  그렇게 ARP 패킷을 받은 PC D는 다시 패킷을 PC A로 돌려보낸다.
    이 과정에서 스위치는 PC A와 PC D의 포트 번호와 MAC 주소를 학습하게 된다.
4.  다음에 ICMP 패킷을 보낼 때 스위치에게 보내고 스위치는 어디로 가야 하는 지
    알기 때문에 PC D로 바로 전송한다.

이렇게 허브와는 다르게 스위치는 지정된 포트로만 전기적 신호를 보낼 수 있기 때문에
허브보다 훨씬 좋은 성능을 가지고 있으나, 비싸다는 단점이 있다.
그리고 콜리전도메인을 살펴보면 스위치는 연결된 네트워크 장비당 하나의 콜리전 도메인이 생성되므로
콜리전도메인은 현재 상태에서는 4개가 된다.